---
---

<div
  id="next-section-widget"
  class="fixed bottom-6 right-6 z-40 opacity-0 translate-y-4 pointer-events-none transition-all duration-300"
>
  <a
    id="next-section-link"
    href="#modulo-1"
    class="flex items-center gap-3 px-4 py-3 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-xl shadow-lg hover:shadow-xl hover:border-blue-300 dark:hover:border-blue-600 transition-all group max-w-64"
  >
    <div class="flex-1 min-w-0">
      <span class="block text-[10px] uppercase tracking-wider text-slate-400 dark:text-slate-500 font-semibold">Siguiente</span>
      <span id="next-section-label" class="block text-sm font-medium text-slate-700 dark:text-slate-200 truncate group-hover:text-blue-600 dark:group-hover:text-blue-400 transition-colors">
        1. Introducción
      </span>
    </div>
    <div class="shrink-0 w-8 h-8 flex items-center justify-center rounded-full bg-blue-100 dark:bg-blue-900/50 text-blue-600 dark:text-blue-400 group-hover:bg-blue-600 group-hover:text-white dark:group-hover:bg-blue-500 transition-colors">
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2.5">
        <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
      </svg>
    </div>
  </a>
  <button
    id="next-section-close"
    class="absolute -top-2 -right-2 w-5 h-5 flex items-center justify-center rounded-full bg-slate-200 dark:bg-slate-600 text-slate-500 dark:text-slate-300 hover:bg-slate-300 dark:hover:bg-slate-500 transition-colors text-xs cursor-pointer"
    aria-label="Cerrar"
  >
    <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="3">
      <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
    </svg>
  </button>
</div>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const sections = [
      { id: 'inicio', label: 'Inicio' },
      { id: 'modulo-1', label: '1. Introducción' },
      { id: 'modulo-2', label: '2. Primeros pasos' },
      { id: 'modulo-3', label: '3. Archivos y directorios' },
      { id: 'modulo-4', label: '4. Visualización y búsqueda' },
      { id: 'modulo-5', label: '5. Editores de texto' },
      { id: 'modulo-6', label: '6. Permisos y admin' },
      { id: 'modulo-7', label: '7. Procesos' },
      { id: 'modulo-8', label: '8. Bash scripting' },
      { id: 'modulo-9', label: '9. Cron' },
      { id: 'ejercicios', label: 'Ejercicios finales' },
    ];

    const widget = document.getElementById('next-section-widget');
    const link = document.getElementById('next-section-link');
    const label = document.getElementById('next-section-label');
    const closeBtn = document.getElementById('next-section-close');
    if (!widget || !link || !label) return;

    let currentSectionId = 'inicio';
    let dismissed = false;

    const sectionElements = document.querySelectorAll('section[id]');

    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            currentSectionId = entry.target.id;
            updateWidget();
          }
        });
      },
      { rootMargin: '-30% 0px -50% 0px' }
    );

    sectionElements.forEach((section) => observer.observe(section));

    function updateWidget() {
      if (dismissed) return;

      const currentIndex = sections.findIndex(s => s.id === currentSectionId);
      const nextSection = sections[currentIndex + 1];

      // Hide if at last section or at very top
      if (!nextSection || window.scrollY < 300) {
        widget.classList.add('opacity-0', 'translate-y-4', 'pointer-events-none');
        widget.classList.remove('opacity-100', 'translate-y-0', 'pointer-events-auto');
        return;
      }

      link.setAttribute('href', `#${nextSection.id}`);
      label.textContent = nextSection.label;

      widget.classList.remove('opacity-0', 'translate-y-4', 'pointer-events-none');
      widget.classList.add('opacity-100', 'translate-y-0', 'pointer-events-auto');
    }

    window.addEventListener('scroll', () => {
      if (!dismissed) updateWidget();
    });

    // Hide temporarily when clicking to navigate
    link.addEventListener('click', () => {
      widget.classList.add('opacity-0', 'translate-y-4', 'pointer-events-none');
      widget.classList.remove('opacity-100', 'translate-y-0', 'pointer-events-auto');
      setTimeout(updateWidget, 1000);
    });

    // Dismiss widget
    closeBtn?.addEventListener('click', (e) => {
      e.preventDefault();
      e.stopPropagation();
      dismissed = true;
      widget.classList.add('opacity-0', 'translate-y-4', 'pointer-events-none');
      widget.classList.remove('opacity-100', 'translate-y-0', 'pointer-events-auto');
    });
  });
</script>
